<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Uri-Lex</title>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;600;700&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box}
    body{
      margin:0;font-family:'Open Sans',sans-serif;background:#000;
      color:#fff;height:100vh;display:flex;align-items:center;justify-content:center;overflow:hidden;
    }
    /* Splash */
    #splash{
      position:fixed;inset:0;background:#000;display:flex;flex-direction:column;
      align-items:center;justify-content:center;z-index:9999;font-size:3rem;font-weight:700;
      animation:fadeOut 2.8s ease forwards;
    }
    #splash span{display:inline-block;animation:slide 1.2s ease}
    #splash .u{background:#fff;color:#000;padding:10px 15px;border-radius:12px;margin-right:8px;}
    @keyframes slide{from{transform:translateX(-80px);opacity:0}to{transform:translateX(0);opacity:1}}
    @keyframes fadeOut{0%,80%{opacity:1}100%{opacity:0;visibility:hidden}}

    .page{display:none;flex-direction:column;align-items:center;justify-content:center;
      width:90%;max-width:400px;background:rgba(255,255,255,0.05);padding:30px;border-radius:16px;
      box-shadow:0 0 25px rgba(255,255,255,0.05);animation:fadeIn .8s ease forwards}
    .active{display:flex}
    @keyframes fadeIn{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
    input,button{
      width:100%;padding:14px;border:none;border-radius:10px;font-size:1rem;outline:none;
    }
    input{background:#111;color:#fff;margin-bottom:12px}
    button{background:#222;color:#fff;border:2px solid #fff;font-weight:bold;margin-top:4px}
    button:hover{background:#fff;color:#000}
    #googleBtn{background:#fff;color:#000;display:flex;align-items:center;justify-content:center;gap:8px}
    #googleBtn img{width:20px;height:20px}
    .toggle{font-size:.9rem;margin-top:10px;color:#ccc;cursor:pointer}
    .toggle:hover{color:#fff}

    /* Chat page */
    #chatPage{flex-direction:column;align-items:center;justify-content:flex-start;height:100vh;width:100%;max-width:none;border-radius:0;background:#000;padding:10px}
    #chatHeader{font-weight:700;font-size:1.3rem;margin:10px 0;text-align:center}
    #history{width:100%;max-height:120px;overflow-y:auto;margin-bottom:8px;}
    .histItem{background:#111;padding:8px;border-radius:8px;margin-bottom:5px;cursor:pointer}
    #chatBox{flex-grow:1;overflow-y:auto;width:100%;background:#111;border-radius:12px;padding:10px;margin-bottom:10px;}
    .msg{padding:10px;margin:6px 0;border-radius:10px;line-height:1.4}
    .user{background:#222;text-align:right}
    .ai{background:#1a1a1a;border-left:3px solid #00aaff}
    #userInput{width:100%;padding:12px;border-radius:10px;background:#111;color:#fff;border:none;font-size:1rem}
    #sendBtn,#reaskBtn{padding:12px;border-radius:10px;font-weight:600;margin-top:5px;width:100%}
    #sendBtn{background:#00aaff;border:none;color:#fff}
    #reaskBtn{background:#111;border:2px solid #fff;color:#fff;display:none}
    a{color:#4aa3ff;text-decoration:underline;font-weight:bold}
    .typing{font-style:italic;color:#aaa}
    #popup{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);
      background:rgba(255,255,255,0.1);backdrop-filter:blur(10px);
      color:#fff;padding:12px 20px;border-radius:12px;display:none;animation:fadeUp .5s ease}
    @keyframes fadeUp{from{opacity:0;transform:translate(-50%,20px)}to{opacity:1;transform:translate(-50%,0)}}
  </style>
</head>
<body>
  <div id="splash"><span class="u">U</span><span>ri-Lex</span></div>

  <div id="loginPage" class="page active">
    <h1>Welcome to Uri-Lex</h1>
    <input type="email" id="email" placeholder="Email address" />
    <input type="password" id="password" placeholder="Password" />
    <button id="loginBtn">Login</button>
    <button id="signupBtn" style="display:none;">Sign Up</button>
    <button id="googleBtn"><img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg">Login with Google</button>
    <div class="toggle" id="toggleMode">Don’t have an account? Click Sign Up</div>
  </div>

  <div id="chatPage" class="page">
    <div id="chatHeader">Ask, Search, Anything — Your Uri-Lex</div>
    <div id="history"></div>
    <div id="chatBox"></div>
    <input type="text" id="userInput" placeholder="Type your question..." />
    <button id="sendBtn">Send</button>
    <button id="reaskBtn">Re-Ask</button>
  </div>

  <div id="popup"></div>

  <script>
    const showPopup=(m)=>{const p=document.getElementById('popup');p.textContent=m;p.style.display='block';setTimeout(()=>p.style.display='none',2500)};
    window.addEventListener("load",()=>{setTimeout(()=>document.getElementById("splash").style.display="none",2800)});
  </script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";

    const firebaseConfig={
      apiKey:"AIzaSyDAN7mFP_-0MqmRXwN212IMcCbqkuQ-SEQ",
      authDomain:"urlix-d6ae1.firebaseapp.com",
      projectId:"urlix-d6ae1",
      storageBucket:"urlix-d6ae1.firebasestorage.app",
      messagingSenderId:"247920035867",
      appId:"1:247920035867:web:4a8936ec3dd963af2450be"
    };

    const app=initializeApp(firebaseConfig);
    const auth=getAuth(app);
    const provider=new GoogleAuthProvider();

    const loginPage=document.getElementById("loginPage"),chatPage=document.getElementById("chatPage");
    const loginBtn=document.getElementById("loginBtn"),signupBtn=document.getElementById("signupBtn"),
          toggleMode=document.getElementById("toggleMode"),googleBtn=document.getElementById("googleBtn");

    let signupMode=false;
    toggleMode.onclick=()=>{signupMode=!signupMode;
      signupBtn.style.display=signupMode?"block":"none";
      loginBtn.style.display=signupMode?"none":"block";
      toggleMode.textContent=signupMode?"Already have an account? Click Login":"Don’t have an account? Click Sign Up";
    };

    function switchToChat(){loginPage.classList.remove("active");chatPage.classList.add("active");loadHistory();}

    loginBtn.onclick=async()=>{
      try{await signInWithEmailAndPassword(auth,email.value,password.value);localStorage.setItem("user",email.value);switchToChat();showPopup("Welcome to Uri-Lex!");}
      catch(e){showPopup("Uri-Lex Login Issue: "+e.message);}
    };
    signupBtn.onclick=async()=>{
      try{await createUserWithEmailAndPassword(auth,email.value,password.value);localStorage.setItem("user",email.value);switchToChat();showPopup("Account Created!");}
      catch(e){showPopup("Uri-Lex Signup Issue: "+e.message);}
    };
    googleBtn.onclick=async()=>{
      try{await signInWithPopup(auth,provider);switchToChat();showPopup("Logged in via Google.");}
      catch{showPopup("Uri-Lex Google Login Error.");}
    };

    if(localStorage.getItem("user")){setTimeout(()=>switchToChat(),3000);} // splash delay even if logged in

    // Gemini
    const chatBox=document.getElementById("chatBox"),userInput=document.getElementById("userInput");
    const sendBtn=document.getElementById("sendBtn"),reaskBtn=document.getElementById("reaskBtn"),historyBox=document.getElementById("history");
    const apiKey="AIzaSyD4nLeImTfLbnNhcFUIDHhwU2FC7gVkTyo";
    let history=JSON.parse(localStorage.getItem("askHistory")||"[]");

    function loadHistory(){
      historyBox.innerHTML="";
      history.slice(-10).reverse().forEach(q=>{
        const div=document.createElement("div");
        div.className="histItem";div.textContent=q;
        div.onclick=()=>{userInput.value=q;sendMsg();}
        historyBox.appendChild(div);
      });
    }

    async function sendMsg(){
      const text=userInput.value.trim();if(!text)return;
      const u=document.createElement("div");u.className="msg user";u.textContent=text;chatBox.appendChild(u);
      const a=document.createElement("div");a.className="msg ai typing";a.textContent="Uri-Lex is thinking...";chatBox.appendChild(a);
      chatBox.scrollTop=chatBox.scrollHeight;userInput.value="";sendBtn.style.display="none";
      history.push(text);localStorage.setItem("askHistory",JSON.stringify(history));loadHistory();

      const prompt=`Hey Gemini Act As Google. Never use ** or markdown. Just plain clean text with helpful links. App Name: Uri-Lex. User Request: "${text}"`;
      try{
        const res=await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key="+apiKey,{
          method:"POST",headers:{"Content-Type":"application/json"},
          body:JSON.stringify({contents:[{parts:[{text:prompt}]}]})
        });
        const data=await res.json();
        let reply=data.candidates?.[0]?.content?.parts?.[0]?.text||"Uri-Lex couldn’t fetch results.";
        reply=reply.replace(/\*\*/g,"").replace(/\*/g,"").replace(/\n/g,"<br>")
                   .replace(/(https?:\/\/[^\s]+)/g,'<a href="$1" target="_blank">$1</a>');
        a.classList.remove("typing");a.innerHTML=reply;reaskBtn.style.display="block";
        chatBox.scrollTop=chatBox.scrollHeight;
      }catch{a.classList.remove("typing");a.textContent="Uri-Lex had a connection problem.";showPopup("Uri-Lex System Error");}
      finally{sendBtn.style.display="block";}
    }

    sendBtn.onclick=sendMsg;
    reaskBtn.onclick=()=>{userInput.value="";chatBox.innerHTML="";reaskBtn.style.display="none";}
    userInput.oninput=()=>{sendBtn.style.display=userInput.value.trim()?"block":"none";}
    userInput.addEventListener("keypress",e=>{if(e.key==="Enter")sendMsg();});
  </script>
</body>
</html>
